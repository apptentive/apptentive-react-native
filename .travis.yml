# sudo: true
# language: bash
# dist: bionic
# os:
#   - linux
#   - osx

env:
  global:
    - ABI=x86_64
    - ADB_INSTALL_TIMEOUT=8
    - ANDROID_HOME=${HOME}/android-sdk
    - ANDROID_TOOLS_URL="https://dl.google.com/android/repository/sdk-tools-linux-4333796.zip"
    - GRAVIS="https://raw.githubusercontent.com/DanySK/Gravis-CI/master/"
    - EMU_FLAVOR=default
    - EMU_CHANNEL=""
    - JDK="1.8"
    - TOOLS=${ANDROID_HOME}/tools
    - PATH=${ANDROID_HOME}:${ANDROID_HOME}/emulator:${TOOLS}:${TOOLS}/bin:${ANDROID_HOME}/platform-tools:${PATH}
    - UNIT_TEST=FALSE
    - FINALIZE_COVERAGE=FALSE
    - API=28

# addons:
#   artifacts:
#     # â‹®
#     paths:
#       - ./sample61/android/captures/*

jobs:
  include:
    # - stage: e2e
    #   os: osx
    #   language: objective-c
    #   cache:
    #     bundler: true
    #     cocoapods: true
    #     npm: true
    #     pip: true
    #   osx_image: xcode11.2
    #   before_install:
    #     - gem install cocoapods -v '0.32.1'
    #   install:
    #     - npm install
    #     - cd sample61
    #     - npm install
    #     - cd ios
    #     - pod install
    #     - cd ..
    #   script:
    #     - npx react-native bundle --entry-file index.js --platform ios --dev false --bundle-output ios/main.jsbundle --assets-dest ios
    #     - xcodebuild -workspace ios/sample61.xcworkspace/ -scheme sample61 -sdk iphonesimulator -destination  'platform=iOS Simulator,name=iPhone 11' clean build test CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO
    # adapted from ankidriod ci process https://github.com/ankidroid/Anki-Android/blob/master/.travis.yml
    - stage: e2e
      os: linux
      language: android
      dist: trusty
      android:
        components:
          - tools
          - platform-tools
          - build-tools-28.0.3
          - android-28
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
          # - sys-img-x86-android-28
          # - sys-img-armeabi-v7a-android-25
          - sys-img-armeabi-v7a-android-24
        licenses: ".+"
      before_install:
        - nvm install 10
      install: skip
      before_script:
        - android list targets
        - echo no | android create avd --force -n test -t android-24 --abi armeabi-v7a -c 100M
        - emulator -avd test -no-audio -no-window &
        - android-wait-for-emulator
        - adb shell input keyevent 82 &
      script:
        - node --version
        - cd sample61
        - npm install
        - cd android
        - ./gradlew connectedAndroidTest
