env:
  global:
    - ANDROID_API_LEVEL=28
    - ANDROID_BUILD_TOOLS_VERSION=28.0.3

jobs:
  include:
    - stage: Android e2e Test
      language: android
      dist: trusty
      before_install:
        - nvm install 10
        - node --version
      android:
        components:
          - tools
          - platform-tools
          - build-tools-$ANDROID_BUILD_TOOLS_VERSION
          - android-$ANDROID_API_LEVEL
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
          - addon-google_apis-google-$ANDROID_API_LEVEL
          - sys-img-x86-android-$ANDROID_API_LEVEL
        licenses:
          - "android-sdk-preview-license-.+"
          - "android-sdk-license-.+"
          - "google-gdk-license-.+"
        before_script:
          - mkdir -p "$ANDROID_HOME/licenses"
          - cp ./google-licenses/* "$ANDROID_HOME/licenses/"
          - echo no | android create avd --force -n test -t android-28 --abi google_apis/armeabi-v7a
          - emulator -avd test -no-audio -no-window &
          - android-wait-for-emulator
          - adb shell input keyevent 82 &
        script:
          - cd sample61/
          - npm install
          - npm start &
          - cd android/
          - ./gradlew connectedAndroidTest
